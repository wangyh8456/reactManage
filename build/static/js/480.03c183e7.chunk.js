"use strict";(self.webpackChunklayout=self.webpackChunklayout||[]).push([[480],{8480:function(e,n,t){t.r(n),t.d(n,{default:function(){return C}});t(1562);var r=t(7083),i=(t(9918),t(9421)),s=(t(6773),t(4317)),a=(t(224),t(3695)),o=t(5861),c=(t(965),t(3099)),l=(t(5819),t(7309)),u=t(9439),d=(t(798),t(5500)),p=t(7757),f=t.n(p),m=t(2791),x=t(8882),h=t(5796),Z=t(9286),v=t(1413),y=(t(6885),t(6366)),j=(t(8308),t(135)),k=(t(65),t(2085)),w=t(184);function g(e){var n=k.Z.useForm(),t=(0,u.Z)(n,1)[0],r=e.current,i=null===r||void 0===r?void 0:r.id;function s(){return(s=(0,o.Z)(f().mark((function n(t){var s,o,c,l;return f().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(s={name:t.name,sort:t.sort||0},t.pid?(o=e.allmenu.findIndex((function(e){return e.value===t.pid})),s.level=Number(e.allmenu[o].level)+1,s.pid=t.pid):(s.level=1,s.pid=null),!i){n.next=9;break}return c=(0,v.Z)((0,v.Z)({},s),{},{id:r.id}),n.next=6,x._8(c);case 6:l=n.sent,n.next=13;break;case 9:return c=(0,v.Z)({},s),n.next=12,x.bL(c);case 12:l=n.sent;case 13:200===l.status?(a.ZP.success({content:l.message,duration:2}),e.close(),e.getList(),e.getAllList()):a.ZP.error({content:l.message,duration:2});case 14:case"end":return n.stop()}}),n)})))).apply(this,arguments)}return m.useEffect((function(){null!==r&&void 0!==r&&r.id&&(t.setFieldsValue({name:r.name,sort:r.sort}),null!==r&&void 0!==r&&r.pid&&Number(null===r||void 0===r?void 0:r.pid)>=0&&t.setFieldsValue({pid:Number(r.pid)}))}),[]),(0,w.jsxs)(k.Z,{layout:"vertical",form:t,name:"modalform",onFinish:function(e){return s.apply(this,arguments)},onFinishFailed:function(e){console.log(e)},children:[(0,w.jsx)(k.Z.Item,{name:"name",label:"\u540d\u79f0",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u8def\u7531\u540d\u79f0!"}],hasFeedback:!0,children:(0,w.jsx)(j.Z,{})}),(0,w.jsx)(k.Z.Item,{name:"sort",label:"\u6392\u5e8f",children:(0,w.jsx)(j.Z,{})}),(0,w.jsx)(k.Z.Item,{name:"pid",label:"\u4e0a\u7ea7\u8282\u70b9",children:(0,w.jsx)(y.Z,{placeholder:"-\u8bf7\u9009\u62e9-",options:e.allmenu,allowClear:!0})}),(0,w.jsxs)(k.Z.Item,{style:{textAlign:"center"},children:[(0,w.jsx)(l.Z,{style:{marginRight:"30px"},onClick:function(){t.resetFields()},children:"\u91cd\u7f6e"}),(0,w.jsx)(l.Z,{type:"primary",htmlType:"submit",children:"\u786e\u8ba4"})]})]})}var b=d.Z.confirm;function C(){var e=(0,m.useState)([]),n=(0,u.Z)(e,2),t=n[0],p=n[1],v=(0,m.useState)(!1),y=(0,u.Z)(v,2),j=y[0],k=y[1],C=(0,m.useState)(!1),F=(0,u.Z)(C,2),I=F[0],L=F[1],R=(0,m.useState)({}),S=(0,u.Z)(R,2),P=S[0],A=S[1],E=(0,m.useState)([]),N=(0,u.Z)(E,2),O=N[0],U=N[1],z=(0,m.useState)("\u65b0\u5efa\u83dc\u5355"),D=(0,u.Z)(z,2),B=D[0],V=D[1],q=(0,m.useRef)(),H=[{title:"\u83dc\u5355ID",dataIndex:"id",key:"id",render:function(e){return(0,w.jsx)(w.Fragment,{children:e})}},{title:"\u540d\u79f0",dataIndex:"name",key:"name"},{title:"\u6392\u5e8f",dataIndex:"sort",key:"sort"},{title:"\u64cd\u4f5c",key:"action",render:function(e,n){return(0,w.jsxs)(c.Z,{size:"small",children:[(0,w.jsx)(l.Z,{onClick:function(){A(n),V("\u7f16\u8f91\u83dc\u5355"),L(!0)},type:"primary",children:"\u7f16\u8f91"}),(0,w.jsx)(l.Z,{onClick:function(){var e;e=n.id,b({title:"\u5220\u9664\u83dc\u5355",icon:(0,w.jsx)(h.Z,{}),content:"\u786e\u8ba4\u8981\u5220\u9664\u8be5\u83dc\u5355\u5417\uff1f",onOk:function(){return(0,o.Z)(f().mark((function n(){var t;return f().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,x.RD(e);case 2:200===(t=n.sent).status?(a.ZP.success({content:t.message,duration:2}),T(),K()):a.ZP.error({content:t.message,duration:2});case 4:case"end":return n.stop()}}),n)})))()},onCancel:function(){console.log("Cancel")}})},type:"danger",children:"\u5220\u9664"})]})}}];function K(){return M.apply(this,arguments)}function M(){return(M=(0,o.Z)(f().mark((function e(){var n,t;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return k(!0),e.next=3,x.sh();case 3:n=e.sent,t=n.data?n.data:[],U(t.map((function(e){return{label:e.name,value:e.id,level:e.level||0}}))),k(!1);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function T(){return Y.apply(this,arguments)}function Y(){return(Y=(0,o.Z)(f().mark((function e(){var n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return k(!0),e.next=3,x.Af();case 3:n=e.sent,p(n.data),k(!1);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _(){return G.apply(this,arguments)}function G(){return(G=(0,o.Z)(f().mark((function e(){var n,t,r,i;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return k(!0),e.next=3,x.om();case 3:n=e.sent,console.log(n),t=new Blob([n],{type:"application/vnd.ms-excel"}),r=document.createElement("a"),i=window.URL.createObjectURL(t),r.href=i,r.download="\u6a21\u677f.csv",document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(i),a.ZP.success({content:"\u4e0b\u8f7d\u6210\u529f!",duration:2}),k(!1);case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function J(){return(J=(0,o.Z)(f().mark((function e(n){var t;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,k(!0),(t=new FormData).append("file",n.target.files[0]),e.next=6,x.Ms(t);case 6:q.current.value="",a.ZP.success({content:"\u5bfc\u5165\u6210\u529f!",duration:2}),T(),K(),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),a.ZP.error({content:"\u5bfc\u5165\u5931\u8d25!",duration:2});case 15:return e.prev=15,k(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[0,12,15,18]])})))).apply(this,arguments)}return(0,m.useEffect)((function(){T(),K()}),[]),(0,w.jsx)(r.Z,{spinning:j,size:"large",tip:"\u52a0\u8f7d\u4e2d......",children:(0,w.jsxs)("div",{className:"clearfix",children:[(0,w.jsxs)(c.Z,{size:[8,16],wrap:!0,style:{marginBottom:"20px"},children:[(0,w.jsx)(l.Z,{icon:(0,w.jsx)(Z.Z,{}),type:"primary",onClick:function(){A({}),V("\u65b0\u5efa\u83dc\u5355"),L(!0)},children:"\u65b0\u589e\u83dc\u5355"}),(0,w.jsx)(l.Z,{onClick:function(){_()},children:"\u6a21\u677f\u4e0b\u8f7d"}),(0,w.jsxs)("div",{style:{display:"inline-block",position:"relative"},children:[(0,w.jsx)(l.Z,{onClick:function(){_()},children:"\u6279\u91cf\u5bfc\u5165"}),(0,w.jsx)("input",{type:"file",onChange:function(e){!function(e){J.apply(this,arguments)}(e)},ref:q,style:{width:"100%",height:"100%",opacity:"0",position:"absolute",top:"0",left:"0"}})]})]}),(0,w.jsx)(d.Z,{title:B,visible:I,onCancel:function(){L(!1)},bodyStyle:{maxHeight:"700px",overflowY:"auto"},footer:null,style:{top:"50px"},destroyOnClose:!0,children:(0,w.jsx)(g,{close:function(){L(!1)},getList:function(){T()},current:P,allmenu:O.filter((function(e){return e.value!==P.id})),getAllList:function(){K()}})}),(null===t||void 0===t?void 0:t.length)>0?(0,w.jsx)(s.Z,{columns:H,dataSource:t,rowKey:"id",pagination:!1,defaultExpandAllRows:!0}):(0,w.jsx)(i.Z,{})]})})}}}]);
//# sourceMappingURL=480.03c183e7.chunk.js.map